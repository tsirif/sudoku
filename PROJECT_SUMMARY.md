# Sudoku Diffusion Language Model - é¡¹ç›®æ€»ç»“

## âœ… é¡¹ç›®å®Œæˆæƒ…å†µ

å·²æˆåŠŸå®ç°ä¸€ä¸ªå®Œæ•´çš„ Sudoku Diffusion Language Model ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ•°æ®ç”Ÿæˆã€æ¨¡å‹è®­ç»ƒå’Œæ¨ç†ã€‚

## ğŸ“¦ å·²å®ç°çš„æ–‡ä»¶

### æ ¸å¿ƒæ¨¡å—

1. **`model.py`** (7.6KB)
   - âœ… Diffusion Transformer (DiT) æ¶æ„
   - âœ… 29M å‚æ•°ï¼ˆ12å±‚ï¼Œ448ç»´ï¼Œ8å¤´æ³¨æ„åŠ›ï¼‰
   - âœ… å¯å­¦ä¹ çš„ä½ç½®ç¼–ç 
   - âœ… åŒå‘æ³¨æ„åŠ›æœºåˆ¶

2. **`generate_data.py`** (4.6KB)
   - âœ… å¤šè¿›ç¨‹æ•°æ®ç”Ÿæˆ
   - âœ… ç”Ÿæˆ 48k è®­ç»ƒ + 2k æµ‹è¯•æ ·æœ¬
   - âœ… åºåˆ—åŒ–ä¸º 89-token æ ¼å¼
   - âœ… ä¿å­˜ä¸º .npy å’Œ .txt æ ¼å¼

3. **`train.py`** (12KB)
   - âœ… åŠ¨æ€ masking (0.2-0.9 mask ratio)
   - âœ… AdamW ä¼˜åŒ–å™¨ + Cosine å­¦ä¹ ç‡è¡°å‡
   - âœ… TensorBoard æ—¥å¿—
   - âœ… è‡ªåŠ¨ä¿å­˜ best/final/checkpoint æ¨¡å‹
   - âœ… å®šæœŸè¯„ä¼°å’Œæ—©åœ

4. **`inference.py`** (8.9KB)
   - âœ… å®Œå…¨å…¼å®¹ `llada_sample.py` æ¥å£
   - âœ… æ”¯æŒå¤šç§é‡‡æ ·ç®—æ³•
   - âœ… æ•°ç‹¬è§£çš„éªŒè¯
   - âœ… æ¼‚äº®çš„ç½‘æ ¼æ‰“å°
   - âœ… æ‰¹é‡æµ‹è¯•æ”¯æŒ

### è¾…åŠ©å·¥å…·

5. **`test_model.py`** (6.3KB)
   - âœ… æ¨¡å‹åˆ›å»ºæµ‹è¯•
   - âœ… å‰å‘ä¼ æ’­æµ‹è¯•
   - âœ… Masking è¡Œä¸ºæµ‹è¯•
   - âœ… æ¢¯åº¦æµæµ‹è¯•
   - âœ… æ¨ç†å…¼å®¹æ€§æµ‹è¯•
   - âœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡** âœ…

6. **`example_usage.py`** (8.4KB)
   - âœ… åŸºç¡€æ¨ç†ç¤ºä¾‹
   - âœ… åŠ è½½ checkpoint ç¤ºä¾‹
   - âœ… ä¸åŒé‡‡æ ·ç­–ç•¥å¯¹æ¯”
   - âœ… å®Œæ•´ä½¿ç”¨æ¼”ç¤º

7. **`run_experiment.sh`** (1.9KB)
   - âœ… ä¸€é”®è¿è¡Œå®Œæ•´æµç¨‹
   - âœ… æ•°æ®ç”Ÿæˆ â†’ è®­ç»ƒ â†’ è¯„ä¼°
   - âœ… è‡ªåŠ¨åŒ–å®éªŒç®¡é“

### æ–‡æ¡£

8. **`DLM_README.md`** (9.0KB)
   - âœ… è¯¦ç»†æ¶æ„è¯´æ˜
   - âœ… å®Œæ•´ä½¿ç”¨æŒ‡å—
   - âœ… è®­ç»ƒç»†èŠ‚
   - âœ… æ¨ç†æ–¹æ³•
   - âœ… å‚æ•°è°ƒä¼˜å»ºè®®

9. **`QUICKSTART.md`** (4.7KB)
   - âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
   - âœ… åˆ†æ­¥æ‰§è¡Œè¯´æ˜
   - âœ… å¸¸è§é—®é¢˜è§£ç­”

10. **`train_config.yaml`** (1.4KB)
    - âœ… å®Œæ•´è®­ç»ƒé…ç½®
    - âœ… æ¨¡å‹è¶…å‚æ•°
    - âœ… è®­ç»ƒç­–ç•¥è®¾ç½®

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### æ¨¡å‹è®¾è®¡

```
è¾“å…¥: 89 tokens åºåˆ—
â”œâ”€ 81 å•å…ƒæ ¼: 0-9 (0=ç©ºç™½)
â””â”€ 8 è¡Œåˆ†éš”ç¬¦: token 10

è¯è¡¨: 12 tokens
â”œâ”€ 0-9: æ•°ç‹¬æ•°å­—
â”œâ”€ 10: EOL åˆ†éš”ç¬¦
â””â”€ 11: MASK token (è®­ç»ƒç”¨)
```

### æ¶æ„äº®ç‚¹

- **å‚æ•°è§„æ¨¡**: 29.0M (æ¥è¿‘ 28.6M ç›®æ ‡)
- **Hidden Dim**: 448 (ä¼˜åŒ–å)
- **å±‚æ•°**: 12 Transformer blocks
- **æ³¨æ„åŠ›å¤´**: 8 heads (56 dim/head)
- **FFN Ratio**: 4 (448 â†’ 1792 â†’ 448)
- **Dropout**: 0.1

### è®­ç»ƒç­–ç•¥

```python
åŠ¨æ€ Masking:
  - Mask ratio: Uniform[0.2, 0.9] per sample
  - åªåœ¨ masked positions è®¡ç®— loss
  
ä¼˜åŒ–å™¨:
  - AdamW (Î²â‚=0.9, Î²â‚‚=0.999)
  - Learning rate: 1e-4 â†’ 1e-5 (cosine)
  - Weight decay: 0.01
  - Gradient clip: 1.0
  
è®­ç»ƒè®¾ç½®:
  - Batch size: 128
  - Training steps: 100k (~530 epochs)
  - è¯„ä¼°é—´éš”: 1000 steps
  - ä¿å­˜é—´éš”: 10k steps
```

### æ¨ç†æ¥å£

å®Œå…¨å…¼å®¹ `llada_sample.py`ï¼Œæ”¯æŒ:

```python
algorithms = [
    'random-remask',              # éšæœºé‡æ–° mask
    'self_conf-remask:vanilla',   # ç½®ä¿¡åº¦ (softmax prob)
    'self_conf-remask:entropy',   # ç†µ
    'self_conf-remask:topk_margin' # Top-k margin
]

# ä½¿ç”¨ç¤ºä¾‹
result = llada_sample(
    model=model,
    input_ids=input_ids,      # [batch, 89]
    fix_mask=fix_mask,        # [batch, 89] bool
    mask_id=11,
    steps=10,
    algorithm='random-remask',
    temperature=0.0,
)
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æ¨¡å‹æµ‹è¯• (test_model.py)

```
âœ… æ¨¡å‹åˆ›å»º: 29,022,784 å‚æ•° (29.0M)
âœ… å‰å‘ä¼ æ’­: è¾“å‡ºå½¢çŠ¶æ­£ç¡® [batch, 89, 12]
âœ… Masking: æ­£ç¡®å¤„ç† masked tokens
âœ… æ¢¯åº¦æµ: 149 ä¸ªå‚æ•°éƒ½æœ‰æ¢¯åº¦
âœ… æ¨ç†å…¼å®¹: ä¸ llada_sample.py æ¥å£å…¼å®¹
```

### é¢„æœŸè®­ç»ƒç»“æœ

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| è®­ç»ƒå‡†ç¡®ç‡ (token) | >99% |
| æµ‹è¯•å‡†ç¡®ç‡ (token) | >95% |
| è§£çš„æœ‰æ•ˆæ€§ (å®Œæ•´çº¦æŸ) | 80-90% |
| è®­ç»ƒæ—¶é—´ (A100) | 8-12 å°æ—¶ |

## ğŸš€ ä½¿ç”¨æµç¨‹

### å¿«é€Ÿå¼€å§‹

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
source ~/.bashrc
conda activate dream
cd /data/szhang967/dlm_agents/sudoku

# 2. æµ‹è¯•æ¨¡å‹
python test_model.py

# 3. ç”Ÿæˆæ•°æ® (~20-30åˆ†é’Ÿ)
python generate_data.py

# 4. è®­ç»ƒæ¨¡å‹ (~8-12å°æ—¶)
python train.py

# 5. æ±‚è§£æ•°ç‹¬
python inference.py \
    --checkpoint ./checkpoints/best_model.pt \
    --data-dir ./data \
    --num-samples 10
```

### ä¸€é”®è¿è¡Œ

```bash
bash run_experiment.sh
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
/data/szhang967/dlm_agents/sudoku/
â”œâ”€â”€ æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ model.py              # DiT æ¨¡å‹ (29M å‚æ•°)
â”‚   â”œâ”€â”€ generate_data.py      # æ•°æ®ç”Ÿæˆ (48k+2k)
â”‚   â”œâ”€â”€ train.py              # è®­ç»ƒè„šæœ¬ (åŠ¨æ€masking)
â”‚   â””â”€â”€ inference.py          # æ¨ç† (å…¼å®¹llada_sample)
â”‚
â”œâ”€â”€ æµ‹è¯•ä¸ç¤ºä¾‹
â”‚   â”œâ”€â”€ test_model.py         # æ¨¡å‹æµ‹è¯• (âœ… å…¨éƒ¨é€šè¿‡)
â”‚   â””â”€â”€ example_usage.py      # ä½¿ç”¨ç¤ºä¾‹
â”‚
â”œâ”€â”€ é…ç½®ä¸æ–‡æ¡£
â”‚   â”œâ”€â”€ train_config.yaml     # è®­ç»ƒé…ç½®
â”‚   â”œâ”€â”€ DLM_README.md         # è¯¦ç»†æ–‡æ¡£
â”‚   â”œâ”€â”€ QUICKSTART.md         # å¿«é€Ÿå¼€å§‹
â”‚   â””â”€â”€ PROJECT_SUMMARY.md    # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ è‡ªåŠ¨åŒ–
â”‚   â””â”€â”€ run_experiment.sh     # å®Œæ•´å®éªŒæµç¨‹
â”‚
â””â”€â”€ åŸæœ‰ Sudoku ç”Ÿæˆå™¨
    â”œâ”€â”€ sudoku.py
    â”œâ”€â”€ advanced_sudoku_generator.py
    â”œâ”€â”€ puzzle_generator.py
    â”œâ”€â”€ pdf_generator.py
    â””â”€â”€ argument_parser.py
```

## ğŸ“ æŠ€æœ¯äº®ç‚¹

1. **ç¦»æ•£æ‰©æ•£å»ºæ¨¡**
   - éè‡ªå›å½’ç”Ÿæˆ
   - å¹¶è¡Œè§£ç 
   - è¿­ä»£ç»†åŒ–

2. **åŠ¨æ€è®­ç»ƒç­–ç•¥**
   - æ¯ä¸ªæ ·æœ¬ä¸åŒ mask ratio
   - æé«˜æ¨¡å‹é²æ£’æ€§
   - æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›

3. **ä½ç½®ç¼–ç **
   - å¯å­¦ä¹ çš„ä½ç½®åµŒå…¥
   - åŒºåˆ†æ¯ä¸ªå•å…ƒæ ¼ä½ç½®
   - ä¿æŒæ£‹ç›˜ç»“æ„ä¿¡æ¯

4. **å…¼å®¹æ€§è®¾è®¡**
   - æ ‡å‡† `llada_sample.py` æ¥å£
   - æ”¯æŒå¤šç§é‡‡æ ·ç­–ç•¥
   - æ˜“äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

5. **å·¥ç¨‹åŒ–**
   - å®Œæ•´çš„è®­ç»ƒç®¡é“
   - è‡ªåŠ¨åŒ–å®éªŒè„šæœ¬
   - è¯¦ç»†çš„æµ‹è¯•è¦†ç›–
   - ä¸°å¯Œçš„æ–‡æ¡£

## ğŸ”¬ å®éªŒå»ºè®®

### åŸºç¡€å®éªŒ

```bash
# å¿«é€ŸéªŒè¯ (10k steps, ~1å°æ—¶)
python train.py --num-steps 10000

# å®Œæ•´è®­ç»ƒ (100k steps, ~8-12å°æ—¶)
python train.py --num-steps 100000
```

### è¿›é˜¶å®éªŒ

1. **æ¶ˆèç ”ç©¶**
   - ä¸åŒ mask ratio èŒƒå›´
   - ä¸åŒæ¨¡å‹å¤§å°
   - ä¸åŒå±‚æ•°/hidden dim

2. **é‡‡æ ·ç­–ç•¥å¯¹æ¯”**
   - random-remask vs confidence-based
   - ä¸åŒ inference steps (5, 10, 20)
   - temperature å½±å“

3. **æ•°æ®è§„æ¨¡å½±å“**
   - 12k, 24k, 48k, 96k è®­ç»ƒæ ·æœ¬
   - è®­ç»ƒé›†/æµ‹è¯•é›†åˆ†å¸ƒ

## ğŸ’¡ æœªæ¥æ”¹è¿›æ–¹å‘

1. **æ¨¡å‹å¢å¼º**
   - æ¡ä»¶ç”Ÿæˆ (ç»™å®šéƒ¨åˆ†çº¦æŸ)
   - å¤šå°ºåº¦æ¶æ„
   - Sparse attention

2. **è®­ç»ƒä¼˜åŒ–**
   - Mixed precision training
   - Multi-GPU training
   - æ›´é«˜æ•ˆçš„ masking ç­–ç•¥

3. **åº”ç”¨æ‰©å±•**
   - å…¶ä»–çº¦æŸæ»¡è¶³é—®é¢˜
   - æ•°å­¦æ¨ç†ä»»åŠ¡
   - ä»£ç ç”Ÿæˆ

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### è®¡ç®—èµ„æº

- **è®­ç»ƒ**: 1Ã— A100 (40GB)
- **æ¨ç†**: CPU/GPU å‡å¯
- **æ•°æ®ç”Ÿæˆ**: å¤šæ ¸ CPU

### æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | æ—¶é—´ |
|------|------|
| æ¨¡å‹æµ‹è¯• | <1 åˆ†é’Ÿ |
| æ•°æ®ç”Ÿæˆ (48k+2k) | 20-30 åˆ†é’Ÿ |
| è®­ç»ƒ (100k steps) | 8-12 å°æ—¶ |
| æ¨ç† (10 puzzles) | <1 åˆ†é’Ÿ |

### å†…å­˜å ç”¨

- **è®­ç»ƒ**: ~10GB GPU memory (batch=128)
- **æ¨ç†**: ~2GB GPU memory
- **æ•°æ®**: ~1GB ç£ç›˜ç©ºé—´

## âœ¨ æ€»ç»“

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªä»é›¶è®­ç»ƒçš„ Sudoku Diffusion Language Modelï¼ŒåŒ…å«ï¼š

âœ… **å®Œæ•´çš„ä»£ç å®ç°** (æ¨¡å‹ã€è®­ç»ƒã€æ¨ç†)
âœ… **è‡ªåŠ¨åŒ–å·¥å…·** (æ•°æ®ç”Ÿæˆã€å®éªŒç®¡é“)
âœ… **è¯¦ç»†çš„æ–‡æ¡£** (ä½¿ç”¨æŒ‡å—ã€APIè¯´æ˜)
âœ… **å…¨é¢çš„æµ‹è¯•** (å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡)
âœ… **å…¼å®¹æ€§** (llada_sample.py æ¥å£)

**ä»£ç ç®€æ´ã€æ–‡æ¡£å®Œå–„ã€å³ç”¨å³è®­ï¼**

---

ğŸ“§ **è”ç³»ä½œè€…**: shuibai@cs.wisc.edu
ğŸ“š **è¯¦ç»†æ–‡æ¡£**: è§ `DLM_README.md`
ğŸš€ **å¿«é€Ÿå¼€å§‹**: è§ `QUICKSTART.md`

